"use strict";var objectToString=Object.prototype.toString,isArray=Array.isArray||function(e){return"[object Array]"===objectToString.call(e)};function isFunction(e){return"function"==typeof e}function typeStr(e){return isArray(e)?"array":typeof e}function escapeRegExp(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function hasProperty(e,t){return null!=e&&"object"==typeof e&&t in e}function primitiveHasOwnProperty(e,t){return null!=e&&"object"!=typeof e&&e.hasOwnProperty&&e.hasOwnProperty(t)}var regExpTest=RegExp.prototype.test;function testRegExp(e,t){return regExpTest.call(e,t)}var nonSpaceRe=/\S/;function isWhitespace(e){return!testRegExp(nonSpaceRe,e)}var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function escapeHtml(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return entityMap[e]})}var whiteRe=/\s*/,spaceRe=/\s+/,equalsRe=/\s*=/,curlyRe=/\s*\}/,tagRe=/#|\^|\/|>|\{|&|=|!/;function parseTemplate(e,t){if(!e)return[];var r,n,i,s=!1,a=[],o=[],c=[],u=!1,p=!1,h="",l=0;function f(){if(u&&!p)for(;c.length;)delete o[c.pop()];else c=[];u=!1,p=!1}function g(e){if("string"==typeof e&&(e=e.split(spaceRe,2)),!isArray(e)||2!==e.length)throw new Error("Invalid tags: "+e);r=new RegExp(escapeRegExp(e[0])+"\\s*"),n=new RegExp("\\s*"+escapeRegExp(e[1])),i=new RegExp("\\s*"+escapeRegExp("}"+e[1]))}g(t||mustache.tags);for(var d,v,y,w,m,x,R=new Scanner(e);!R.eos();){if(d=R.pos,y=R.scanUntil(r))for(var k=0,W=y.length;k<W;++k)isWhitespace(w=y.charAt(k))?(c.push(o.length),h+=w):(p=!0,s=!0,h+=" "),o.push(["text",w,d,d+1]),d+=1,"\n"===w&&(f(),h="",l=0,s=!1);if(!R.scan(r))break;if(u=!0,v=R.scan(tagRe)||"name",R.scan(whiteRe),"="===v?(y=R.scanUntil(equalsRe),R.scan(equalsRe),R.scanUntil(n)):"{"===v?(y=R.scanUntil(i),R.scan(curlyRe),R.scanUntil(n),v="&"):y=R.scanUntil(n),!R.scan(n))throw new Error("Unclosed tag at "+R.pos);if(m=">"==v?[v,y,d,R.pos,h,l,s]:[v,y,d,R.pos],l++,o.push(m),"#"===v||"^"===v)a.push(m);else if("/"===v){if(!(x=a.pop()))throw new Error('Unopened section "'+y+'" at '+d);if(x[1]!==y)throw new Error('Unclosed section "'+x[1]+'" at '+d)}else"name"===v||"{"===v||"&"===v?p=!0:"="===v&&g(y)}if(f(),x=a.pop())throw new Error('Unclosed section "'+x[1]+'" at '+R.pos);return nestTokens(squashTokens(o))}function squashTokens(e){for(var t,r,n=[],i=0,s=e.length;i<s;++i)(t=e[i])&&("text"===t[0]&&r&&"text"===r[0]?(r[1]+=t[1],r[3]=t[3]):(n.push(t),r=t));return n}function nestTokens(e){for(var t,r=[],n=r,i=[],s=0,a=e.length;s<a;++s)switch((t=e[s])[0]){case"#":case"^":n.push(t),i.push(t),n=t[4]=[];break;case"/":i.pop()[5]=t[2],n=i.length>0?i[i.length-1][4]:r;break;default:n.push(t)}return r}function Scanner(e){this.string=e,this.tail=e,this.pos=0}function Context(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function Writer(){this.cache={}}Scanner.prototype.eos=function(){return""===this.tail},Scanner.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r},Scanner.prototype.scanUntil=function(e){var t,r=this.tail.search(e);switch(r){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,r),this.tail=this.tail.substring(r)}return this.pos+=t.length,t},Context.prototype.push=function(e){return new Context(e,this)},Context.prototype.lookup=function(e){var t,r=this.cache;if(r.hasOwnProperty(e))t=r[e];else{for(var n,i,s,a=this,o=!1;a;){if(e.indexOf(".")>0)for(n=a.view,i=e.split("."),s=0;null!=n&&s<i.length;)s===i.length-1&&(o=hasProperty(n,i[s])||primitiveHasOwnProperty(n,i[s])),n=n[i[s++]];else n=a.view[e],o=hasProperty(a.view,e);if(o){t=n;break}a=a.parent}r[e]=t}return isFunction(t)&&(t=t.call(this.view)),t},Writer.prototype.clearCache=function(){this.cache={}},Writer.prototype.parse=function(e,t){var r=this.cache,n=e+":"+(t||mustache.tags).join(":"),i=r[n];return null==i&&(i=r[n]=parseTemplate(e,t)),i},Writer.prototype.render=function(e,t,r,n){var i=this.parse(e,n),s=t instanceof Context?t:new Context(t,void 0);return this.renderTokens(i,s,r,e,n)},Writer.prototype.renderTokens=function(e,t,r,n,i){for(var s,a,o,c="",u=0,p=e.length;u<p;++u)o=void 0,"#"===(a=(s=e[u])[0])?o=this.renderSection(s,t,r,n):"^"===a?o=this.renderInverted(s,t,r,n):">"===a?o=this.renderPartial(s,t,r,i):"&"===a?o=this.unescapedValue(s,t):"name"===a?o=this.escapedValue(s,t):"text"===a&&(o=this.rawValue(s)),void 0!==o&&(c+=o);return c},Writer.prototype.renderSection=function(e,t,r,n){var i=this,s="",a=t.lookup(e[1]);if(a){if(isArray(a))for(var o=0,c=a.length;o<c;++o)s+=this.renderTokens(e[4],t.push(a[o]),r,n);else if("object"==typeof a||"string"==typeof a||"number"==typeof a)s+=this.renderTokens(e[4],t.push(a),r,n);else if(isFunction(a)){if("string"!=typeof n)throw new Error("Cannot use higher-order sections without the original template");null!=(a=a.call(t.view,n.slice(e[3],e[5]),function(e){return i.render(e,t,r)}))&&(s+=a)}else s+=this.renderTokens(e[4],t,r,n);return s}},Writer.prototype.renderInverted=function(e,t,r,n){var i=t.lookup(e[1]);if(!i||isArray(i)&&0===i.length)return this.renderTokens(e[4],t,r,n)},Writer.prototype.indentPartial=function(e,t,r){for(var n=t.replace(/[^ \t]/g,""),i=e.split("\n"),s=0;s<i.length;s++)i[s].length&&(s>0||!r)&&(i[s]=n+i[s]);return i.join("\n")},Writer.prototype.renderPartial=function(e,t,r,n){if(r){var i=isFunction(r)?r(e[1]):r[e[1]];if(null!=i){var s=e[6],a=e[5],o=e[4],c=i;return 0==a&&o&&(c=this.indentPartial(i,o,s)),this.renderTokens(this.parse(c,n),t,r,c)}}},Writer.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(null!=r)return r},Writer.prototype.escapedValue=function(e,t){var r=t.lookup(e[1]);if(null!=r)return mustache.escape(r)},Writer.prototype.rawValue=function(e){return e[1]};var mustache={name:"mustache.js",version:"3.2.1",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,to_html:void 0,Scanner:void 0,Context:void 0,Writer:void 0},defaultWriter=new Writer;mustache.clearCache=function(){return defaultWriter.clearCache()},mustache.parse=function(e,t){return defaultWriter.parse(e,t)},mustache.render=function(e,t,r,n){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+typeStr(e)+'" was given as the first argument for mustache#render(template, view, partials)');return defaultWriter.render(e,t,r,n)},mustache.to_html=function(e,t,r,n){var i=mustache.render(e,t,r);if(!isFunction(n))return i;n(i)},mustache.escape=escapeHtml,mustache.Scanner=Scanner,mustache.Context=Context,mustache.Writer=Writer,module.exports=mustache;